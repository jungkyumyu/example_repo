<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title> ì •ê²¸&ê°€ëŒ ë„ì¿„ì—¬í–‰ </title>
    
    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Tokyo Trip">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- App Icon (Must be PNG for iOS) -->
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/854/854878.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/854/854878.png">

    <!-- Web App Manifest (Data URI) -->
    <link rel="manifest" href='data:application/manifest+json,{"name":"ë„ì¿„ ì—¬í–‰ ì§€ë„","short_name":"ë„ì¿„ì—¬í–‰","start_url":".","display":"standalone","background_color":"#ffffff","theme_color":"#ffffff","icons":[{"src":"https://cdn-icons-png.flaticon.com/512/854/854878.png","sizes":"512x512","type":"image/png"}]}'>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Toastify CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <!-- Toastify JS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <style>
        #map { height: 100%; width: 100%; z-index: 1; }
        body, html { height: 100%; margin: 0; padding: 0; overflow: hidden; /* Prevent elastic scrolling on iOS */ }
        
        /* Custom Tooltip */
        .leaflet-tooltip.custom-tooltip {
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            font-size: 11px;
            font-weight: bold;
            color: #333;
            padding: 2px 5px;
            border-radius: 4px;
            text-align: center;
            white-space: nowrap;
        }

        /* List Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888; 
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555; 
        }

        /* Safe Area for iPhone X+ */
        header {
            padding-top: env(safe-area-inset-top);
        }
        #list-container {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Toggle Checkbox Style */
        .category-toggle {
            accent-color: #4B5563; /* Gray-600 */
            width: 1.2rem;
            height: 1.2rem;
            cursor: pointer;
        }
        
        /* User Location Pulse Animation */
        @keyframes pulse-blue {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }
        .user-pulse {
            background-color: #3B82F6;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid white;
            animation: pulse-blue 2s infinite;
        }
    </style>
</head>
<body class="flex flex-col h-screen bg-gray-100">

    <!-- Header -->
    <header class="bg-gray-900 text-white p-4 shadow-md z-10 flex justify-between items-center pt-safe">
        <div>
            <h1 class="text-xl font-bold">GR&JK Tokyo Trip</h1>
            <p class="text-sm text-gray-400"> ê°€ëŒ&ì •ê²¸ ë„ì¿„ ì—¬í–‰ </p>
        </div>
    </header>

    <!-- Map Container -->
    <div class="flex-grow relative">
        <div id="map"></div>
        
        <!-- My Location Button (Top Left) -->
        <button id="my-location-btn" 
                class="absolute top-4 left-4 z-[400] bg-white p-2 rounded-lg shadow-md border border-gray-300 text-gray-600 hover:text-blue-600 hover:bg-gray-50 focus:outline-none transition-colors"
                onclick="findMyLocation()"
                title="ë‚´ ìœ„ì¹˜ ë³´ê¸°">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        </button>
    </div>

    <!-- Collapsible Location List -->
    <div id="list-container" class="bg-white border-t border-gray-200 lg:border-none lg:rounded-lg lg:shadow-2xl z-20 
                                  fixed bottom-0 left-0 w-full lg:absolute lg:top-4 lg:right-4 lg:left-auto lg:w-80 lg:h-auto lg:bottom-auto transition-all duration-300 flex flex-col max-h-[50vh] lg:max-h-[80vh] pb-safe">
        
        <!-- List Header (Click to Toggle) -->
        <div id="list-header" class="p-3 bg-gray-50 border-b border-gray-200 cursor-pointer flex justify-between items-center rounded-t-lg hover:bg-gray-100 transition-colors">
            <h2 class="font-bold text-gray-800">ğŸ“ ì¥ì†Œ ëª©ë¡ / í•„í„°</h2>
            <span id="toggle-icon" class="text-gray-500 text-xl transform transition-transform duration-300">â–¼</span>
        </div>

        <!-- List Content -->
        <div id="list-content" class="overflow-y-auto custom-scrollbar p-4 transition-all duration-300">
            
            <!-- Hotel (Always Visible) -->
            <div class="mb-4">
                <div class="flex justify-between items-center border-b border-red-200 pb-1 mb-2 sticky top-0 bg-white z-10">
                    <h3 class="text-sm font-semibold text-red-600">ğŸ  ìˆ™ì†Œ (Hotel)</h3>
                </div>
                <ul class="text-sm space-y-1" id="list-hotel"></ul>
            </div>

            <!-- Wife Food (Toggle) -->
            <div class="mb-4">
                <div class="flex justify-between items-center border-b border-purple-200 pb-1 mb-2 sticky top-0 bg-white z-10">
                    <h3 class="text-sm font-semibold text-purple-600">ğŸ‘©ğŸ»â€â¤ï¸â€ğŸ‘¨ğŸ» ì™€ì´í”„-ë°¥ì§‘</h3>
                    <label class="flex items-center space-x-1 cursor-pointer">
                        <span class="text-xs text-gray-500">ë³´ê¸°</span>
                        <input type="checkbox" class="category-toggle" checked onchange="toggleCategory('wife_food', this.checked)">
                    </label>
                </div>
                <ul class="text-sm space-y-1" id="list-wife_food"></ul>
            </div>

            <!-- Wife Cafe (Toggle) -->
            <div class="mb-4">
                <div class="flex justify-between items-center border-b border-yellow-200 pb-1 mb-2 sticky top-0 bg-white z-10">
                    <h3 class="text-sm font-semibold text-yellow-600">â˜• ì™€ì´í”„-ì¹´í˜</h3>
                    <label class="flex items-center space-x-1 cursor-pointer">
                        <span class="text-xs text-gray-500">ë³´ê¸°</span>
                        <input type="checkbox" class="category-toggle" checked onchange="toggleCategory('wife_cafe', this.checked)">
                    </label>
                </div>
                <ul class="text-sm space-y-1" id="list-wife_cafe"></ul>
            </div>

            <!-- Landmarks (Toggle) -->
            <div class="mb-4">
                <div class="flex justify-between items-center border-b border-green-200 pb-1 mb-2 sticky top-0 bg-white z-10">
                    <h3 class="text-sm font-semibold text-green-600">ğŸ¢ ëœë“œë§ˆí¬ (Landmark)</h3>
                    <label class="flex items-center space-x-1 cursor-pointer">
                        <span class="text-xs text-gray-500">ë³´ê¸°</span>
                        <input type="checkbox" class="category-toggle" checked onchange="toggleCategory('special', this.checked)">
                    </label>
                </div>
                <ul class="text-sm space-y-1" id="list-special"></ul>
            </div>

            <!-- Shopping (Toggle) -->
            <div class="mb-4">
                <div class="flex justify-between items-center border-b border-blue-200 pb-1 mb-2 sticky top-0 bg-white z-10">
                    <h3 class="text-sm font-semibold text-blue-600">ğŸ‘• ì‡¼í•‘ (Shopping)</h3>
                    <label class="flex items-center space-x-1 cursor-pointer">
                        <span class="text-xs text-gray-500">ë³´ê¸°</span>
                        <input type="checkbox" class="category-toggle" checked onchange="toggleCategory('shopping', this.checked)">
                    </label>
                </div>
                <ul class="text-sm space-y-1" id="list-shopping"></ul>
            </div>

            <!-- Food (Toggle) -->
            <div class="mb-4">
                <div class="flex justify-between items-center border-b border-orange-200 pb-1 mb-2 sticky top-0 bg-white z-10">
                    <h3 class="text-sm font-semibold text-orange-600">ğŸœ ë§›ì§‘ & ì¹´í˜ (Food)</h3>
                    <label class="flex items-center space-x-1 cursor-pointer">
                        <span class="text-xs text-gray-500">ë³´ê¸°</span>
                        <input type="checkbox" class="category-toggle" checked onchange="toggleCategory('food', this.checked)">
                    </label>
                </div>
                <ul class="text-sm space-y-1" id="list-food"></ul>
            </div>
        </div>
    </div>

    <!-- Hidden Input for Copy -->
    <input type="text" id="copy-input" style="position: absolute; left: -9999px;">

    <script>
        // --- 1. Map Initialization ---
        const map = L.map('map', { zoomControl: false }).setView([35.661448, 139.703109], 13);
        L.control.zoom({ position: 'bottomleft' }).addTo(map);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // --- 2. Icons ---
        const createIcon = (color) => new L.Icon({
            iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${color}.png`,
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        const icons = {
            hotel: createIcon('red'),
            shopping: createIcon('blue'),
            special: createIcon('green'),
            food: createIcon('orange'),
            wife_food: createIcon('violet'), // ë³´ë¼ìƒ‰
            wife_cafe: createIcon('gold')    // ë…¸ë€ìƒ‰(ê³¨ë“œ)
        };

        // --- 3. Data with Addresses ---
        const locations = [
            // Hotel
            { name: "All Day Place Shibuya", lat: 35.661494, lng: 139.703126, type: "hotel", desc: "ë¯¸ì•¼ì‹œíƒ€ íŒŒí¬ ì˜† í˜¸í…”", address: "1 Chome-17-1 Shibuya, Shibuya City, Tokyo 150-0002" },

            // Landmarks (Added New)
            { name: "Seibu Shibuya", lat: 35.6603, lng: 139.7004, type: "special", desc: "ë°±í™”ì ", address: "21-1 Udagawacho, Shibuya City, Tokyo 150-8330" },
            { name: "21_21 Design Sight", lat: 35.6661, lng: 139.7300, type: "special", desc: "ì „ì‹œê´€/ë¯¸ìˆ ê´€", address: "9 Chome-7-6 Akasaka, Minato City, Tokyo 107-0052" },
            { name: "National Art Center", lat: 35.6652, lng: 139.7264, type: "special", desc: "êµ­ë¦½ì‹ ë¯¸ìˆ ê´€", address: "7 Chome-22-2 Roppongi, Minato City, Tokyo 106-8558" },
            { name: "Akachan Honpo Kinshicho", lat: 35.6975, lng: 139.8138, type: "special", desc: "ì•„ë™ë³µ ì „ë¬¸ (ì•„ì¹´ì§±í˜¼í¬)", address: "2 Chomeâˆ’2âˆ’1 ArcaKit Kinshicho 5F, Sumida City, Tokyo 130-0013" },
            { name: "Toranomon Hills", lat: 35.6662, lng: 139.7495, type: "special", desc: "ë³µí•© ë¬¸í™” ê³µê°„ (êµ¬ê²½)", address: "1 Chome-23-1 Toranomon, Minato City, Tokyo 105-6390" },
            { name: "OZEKI Tokyo Gallery", lat: 35.6860, lng: 139.7798, type: "special", desc: "ì•„ì¹´ë¦¬ ì¡°ëª… (ì´ì‚¬ë¬´ ë…¸êµ¬ì¹˜)", address: "1 Chome-2-6 Nihonbashiningyocho, Chuo City, Tokyo 103-0013" },

            // Wife's Food (New Category)
            { name: "Tsujihan Ark Hills", lat: 35.6675, lng: 139.7397, type: "wife_food", desc: "ì¹´ì´ì„¼ë™ (ì•„í¬ëª¨ë¦¬ ë¹Œë”©)", address: "1 Chomeâˆ’12âˆ’32 Ark Mori Building 3F, Akasaka, Minato City, Tokyo 107-0052" },
            { name: "Onigiri Cafe", lat: 35.6688, lng: 139.6932, type: "wife_food", desc: "ì¡°ì‹ (ì˜¤ë‹ˆê¸°ë¦¬)", address: "1 Chomeâˆ’9âˆ’15, Tomigaya, Shibuya, Tokyo 151-0063" },
            { name: "Yakiniku Inoue Ginza", lat: 35.674315, lng: 139.766763, type: "wife_food", desc: "ì•¼í‚¤ë‹ˆì¿ ", address: "1 Chome-6-6 Ginza, Chuo City, Tokyo 104-0061" },
            { name: "Sekiya Spaghetti", lat: 35.644485, lng: 139.699564, type: "wife_food", desc: "ìŠ¤íŒŒê²Œí‹°", address: "2 Chome-29-8 Kamimeguro, Meguro City, Tokyo 153-0051" },
            { name: "Otazushi", lat: 35.685382, lng: 139.780362, type: "wife_food", desc: "ìŠ¤ì‹œ ì˜¤ë§ˆì¹´ì„¸", address: "1 Chome-5-2 Nihonbashiningyocho, Chuo City, Tokyo 103-0013" },
            { name: "Nihonbashi Tonkatsu Hajime", lat: 35.6865, lng: 139.7758, type: "wife_food", desc: "ëˆê°€ìŠ¤", address: "1 Chomeâˆ’13âˆ’9, Nihonbashimuromachi, Chuo City, Tokyo 103-0022" },

            // Wife's Cafe (New Category)
            { name: "Bongen Coffee Ginza", lat: 35.6724, lng: 139.7707, type: "wife_cafe", desc: "ì¹´í˜ (ë³¸ê² ì»¤í”¼)", address: "2 Chome-16-3 Ginza, Chuo City, Tokyo 104-0061" },
            { name: "Glitch Coffee Ginza", lat: 35.6702, lng: 139.7695, type: "wife_cafe", desc: "ì¹´í˜ (ê¸€ë¦¿ì¹˜ ì»¤í”¼)", address: "4 Chomeâˆ’14âˆ’8 Ginza, Chuo City, Tokyo 104-0061" },
            { name: "Camelback Sandwich", lat: 35.6639, lng: 139.6924, type: "wife_cafe", desc: "ì¹´í˜ (ìƒŒë“œìœ„ì¹˜)", address: "42-2 Kamiyamacho, Shibuya, Tokyo 150-0047" },
            { name: "Cloud Club Matcha", lat: 35.6710, lng: 139.7685, type: "wife_cafe", desc: "ë§ì°¨ ì¹´í˜", address: "3 Chome-14-6 Ginza, Chuo City, Tokyo 104-0061" },

            // Shopping (New & Existing)
            { name: "Hankyu Men's Tokyo", lat: 35.6732, lng: 139.7615, type: "shopping", desc: "ë°±í™”ì  (RRL, WareHouse ë“±)", address: "2 Chome-5-1 Yurakucho, Chiyoda City, Tokyo 100-8488" },
            { name: "Isetan Men's Shinjuku", lat: 35.6916, lng: 139.7046, type: "shopping", desc: "ë°±í™”ì  (RRL ë“±)", address: "3 Chome-14-1 Shinjuku, Shinjuku City, Tokyo 160-0022" },
            { name: "Kith Tokyo", lat: 35.6617, lng: 139.7018, type: "shopping", desc: "ìŠ¤ë‹ˆì»¤ì¦ˆ & ìŠ¤íŠ¸ë¦¿ í¸ì§‘ìƒµ", address: "6 Chome-20-10 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "Kapital Ebisu", lat: 35.6469, lng: 139.7090, type: "shopping", desc: "ìºí”¼íƒˆ", address: "2 Chome-20-2 Ebisuminami, Shibuya City, Tokyo 150-0022" },
            { name: "Kapital Roppongi", lat: 35.6604, lng: 139.7292, type: "shopping", desc: "ìºí”¼íƒˆ", address: "6 Chome-10-1 Roppongi, Minato City, Tokyo 106-6108" },
            { name: "The Flat Head", lat: 35.6710, lng: 139.7060, type: "shopping", desc: "ë” í”Œë« í—¤ë“œ", address: "3 Chome-24-2 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "PITTZZ", lat: 35.6738, lng: 139.7085, type: "shopping", desc: "ë¹ˆí‹°ì§€ìƒµ", address: "2 Chome-16-16 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "RAGTAG Harajuku", lat: 35.6672, lng: 139.7068, type: "shopping", desc: "ì„¸ì»¨í•¸ë“œìƒµ", address: "6 Chome-14-2 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "RAGTAG Shibuya", lat: 35.6631, lng: 139.7004, type: "shopping", desc: "ì„¸ì»¨í•¸ë“œìƒµ", address: "1 Chome-17-7 Jinnan, Shibuya City, Tokyo 150-0041" },
            { name: "Nanamica Daikanyama", lat: 35.6508, lng: 139.6995, type: "shopping", desc: "ë‚˜ë‚˜ë¯¸ì¹´", address: "26-13 Sarugakucho, Shibuya City, Tokyo 150-0033" },
            { name: "L'ECHOPPE Aoyama", lat: 35.6648, lng: 139.7145, type: "shopping", desc: "í¸ì§‘ìƒµ", address: "3 Chome-17-3 Minamiaoyama, Minato City, Tokyo 107-0062" },
            { name: "1LDK Nakameguro", lat: 35.6462, lng: 139.6980, type: "shopping", desc: "í¸ì§‘ìƒµ", address: "1 Chome-8-28 Kamimeguro, Meguro City, Tokyo 153-0051" },
            { name: "Freak's Store Shibuya", lat: 35.6618, lng: 139.7005, type: "shopping", desc: "ì•„ë©”ì¹´ì§€ í¸ì§‘ìƒµ", address: "1 Chome-13-1 Jinnan, Shibuya City, Tokyo 150-0041" },
            { name: "United Arrows Harajuku", lat: 35.6688, lng: 139.7047, type: "shopping", desc: "í¸ì§‘ìƒµ", address: "3 Chome-28-1 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "Junky Special", lat: 35.694768, lng: 139.702812, type: "shopping", desc: "í¸ì§‘ìƒµ (Buzz Rickson ë“±)", address: "1 Chome-23-17 Kabukicho, Shinjuku City, Tokyo 160-0021" },
            { name: "Beams Plus Harajuku", lat: 35.671848, lng: 139.707525, type: "shopping", desc: "ì•„ë©”ì¹´ì§€ í¸ì§‘ìƒµ (WareHouse ë“±)", address: "3 Chome-25-12 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "The Real McCoy's Tokyo", lat: 35.664467, lng: 139.702758, type: "shopping", desc: "ë¦¬ì–¼ë§¥ì½”ì´ (Real McCoy)", address: "6 Chome-25-8 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "RRL Omotesando", lat: 35.667180, lng: 139.708892, type: "shopping", desc: "ë”ë¸”ì•Œì—˜ (RRL)", address: "4 Chome-12-10 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "Desolation Row", lat: 35.6650, lng: 139.7030, type: "shopping", desc: "í”„ë¦¬íœ ëŸ¬ìŠ¤", address: "2 Chome-31-3 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "Hollywood Ranch Market", lat: 35.649626, lng: 139.703664, type: "shopping", desc: "ì•„ë©”ì¹´ì§€ í¸ì§‘ìƒµ", address: "28-17 Sarugakucho, Shibuya City, Tokyo 150-0033" },
            { name: "Warehouse & Co. Tokyo", lat: 35.649460, lng: 139.707563, type: "shopping", desc: "ì›¨ì–´í•˜ìš°ìŠ¤ (WareHouse)", address: "1 Chome-29-8 Ebisunishi, Shibuya City, Tokyo 150-0021" },
            { name: "Okura", lat: 35.6485, lng: 139.7025, type: "shopping", desc: "ë¸”ë£¨ë¸”ë£¨ ì¬íŒ¬", address: "20-11 Sarugakucho, Shibuya City, Tokyo 150-0033" },
            { name: "Hinoya (Ueno)", lat: 35.709424, lng: 139.774776, type: "shopping", desc: "í¸ì§‘ìƒµ (Buzz Rickson, WareHouse ë“±)", address: "6 Chome-10-14 Ueno, Taito City, Tokyo 110-0005" },
            { name: "BerBerJin", lat: 35.669865, lng: 139.706869, type: "shopping", desc: "ë¹ˆí‹°ì§€ìƒµ", address: "3 Chome-26-11 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "Fake Alpha", lat: 35.668726, lng: 139.707449, type: "shopping", desc: "ë¹ˆí‹°ì§€ìƒµ", address: "1 Chome-6-11 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "Fullcount Tokyo", lat: 35.6695, lng: 139.7055, type: "shopping", desc: "í’€ì¹´ìš´íŠ¸ (FullCount)", address: "3 Chome-20-7 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "Supreme Shibuya", lat: 35.663364, lng: 139.700772, type: "shopping", desc: "ìŠˆí”„ë¦¼", address: "1 Chome-18-2 Jinnan, Shibuya City, Tokyo 150-0041" },
            { name: "Supreme Harajuku", lat: 35.669968, lng: 139.706692, type: "shopping", desc: "ìŠˆí”„ë¦¼", address: "4 Chome-32-7 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "Supreme Daikanyama", lat: 35.6491, lng: 139.7028, type: "shopping", desc: "ìŠˆí”„ë¦¼", address: "1 Chome-6 Sarugakucho, Shibuya City, Tokyo 150-0033" },
            { name: "Stussy Shibuya", lat: 35.662548, lng: 139.700251, type: "shopping", desc: "ìŠ¤íˆ¬ì‹œ", address: "1 Chome-14-5 Jinnan, Shibuya City, Tokyo 150-0041" },
            { name: "Stussy Harajuku", lat: 35.669352, lng: 139.706132, type: "shopping", desc: "ìŠ¤íˆ¬ì‹œ", address: "4 Chome-28-2 Jingumae, Shibuya City, Tokyo 150-0001" },

            // Food & Cafe
            { name: "Tsujihan Nihonbashi", lat: 35.6822, lng: 139.7733, type: "food", desc: "ì¹´ì´ì„¼ë™", address: "3 Chome-1-15 Nihonbashi, Chuo City, Tokyo 103-0027" },
            { name: "Tsujihan Midtown", lat: 35.6657, lng: 139.7310, type: "food", desc: "ì¹´ì´ì„¼ë™", address: "9 Chome-7-1 Akasaka, Minato City, Tokyo 107-0052" },
            { name: "Time is kani", lat: 35.6668, lng: 139.7755, type: "food", desc: "ê²Œ ìš”ë¦¬ ì „ë¬¸ì ", address: "4-5 Akashicho, Chuo City, Tokyo 104-0044" },
            { name: "Torikatsu Chicken", lat: 35.658097, lng: 139.696884, type: "food", desc: "ë…¸í¬ (íŠ€ê¹€ ì •ì‹)", address: "2 Chome-16-19 Dogenzaka, Shibuya City, Tokyo 150-0043" },
            { name: "Tonkatsu Maisen Aoyama", lat: 35.668551, lng: 139.712330, type: "food", desc: "ëˆì¹´ì¸  ì „ë¬¸ì ", address: "4 Chome-8-5 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "Sakurai Tea Experience", lat: 35.665389, lng: 139.713531, type: "food", desc: "ì¼ë³¸ì°¨(Tea) ì¹´í˜", address: "5 Chome-6-23 Minamiaoyama, Minato City, Tokyo 107-0062" },
            { name: "Toritake", lat: 35.6575, lng: 139.6980, type: "food", desc: "ì•¼í‚¤í† ë¦¬", address: "1 Chome-6-1 Dogenzaka, Shibuya City, Tokyo 150-0043" },
            { name: "Gohan-ya Isseki Sancho", lat: 35.649303, lng: 139.706213, type: "food", desc: "ì¼ë³¸ ê°€ì •ì‹", address: "29-8 Sarugakucho, Shibuya City, Tokyo 150-0033" },
            { name: "Sarutahiko Coffee", lat: 35.647754, lng: 139.709384, type: "food", desc: "ìŠ¤í˜ì…œí‹° ì»¤í”¼", address: "1 Chome-6-1 Ebisu, Shibuya City, Tokyo 150-0013" },
            { name: "Afuri Ramen", lat: 35.648153, lng: 139.710785, type: "food", desc: "ìœ ì ì‹œì˜¤ ë¼ë©˜", address: "1 Chome-1-7 Ebisu, Shibuya City, Tokyo 150-0013" },
            { name: "Katsumidori Seibu", lat: 35.6605, lng: 139.7005, type: "food", desc: "íšŒì „ì´ˆë°¥", address: "21-1 Udagawacho, Shibuya City, Tokyo 150-8330" },
            { name: "Tonkatsu Yamabe (Ueno)", lat: 35.708781, lng: 139.775012, type: "food", desc: "ëˆì¹´ì¸ ", address: "6 Chome-2-6 Ueno, Taito City, Tokyo 110-0005" },
            { name: "Higuma Doughnuts", lat: 35.667500, lng: 139.708000, type: "food", desc: "ë„ë„› & ì»¤í”¼", address: "4 Chome-9-13 Jingumae, Shibuya City, Tokyo 150-0001" },
            { name: "Kaikaya by the Sea", lat: 35.656886, lng: 139.694663, type: "food", desc: "í•´ì‚°ë¬¼ í“¨ì „ ìš”ë¦¬", address: "23-7 Maruyamacho, Shibuya City, Tokyo 150-0044" },
            { name: "Abura Soba Shibuya", lat: 35.659918, lng: 139.702179, type: "food", desc: "ì•„ë¶€ë¼ ì†Œë°”", address: "3 Chome-18-10 Shibuya, Shibuya City, Tokyo 150-0002" },
            { name: "Otazushi (Ningyocho)", lat: 35.685382, lng: 139.780362, type: "food", desc: "ìŠ¤ì‹œ ì˜¤ë§ˆì¹´ì„¸", address: "1 Chome-5-2 Nihonbashiningyocho, Chuo City, Tokyo 103-0013" },
            { name: "Yakiniku Inoue (Ginza)", lat: 35.674315, lng: 139.766763, type: "food", desc: "ì•¼í‚¤ë‹ˆì¿ ", address: "1 Chome-6-6 Ginza, Chuo City, Tokyo 104-0061" },
            { name: "Sekiya Spaghetti (Nakameguro)", lat: 35.644485, lng: 139.699564, type: "food", desc: "ì¼ë³¸ì‹ ìŠ¤íŒŒê²Œí‹°", address: "2 Chome-29-8 Kamimeguro, Meguro City, Tokyo 153-0051" }
        ];

        // Global Copy Function
        function copyAddress(address) {
            const input = document.getElementById('copy-input');
            input.value = address;
            input.select();
            document.execCommand('copy');
            
            Toastify({
                text: "ğŸ“‹ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!",
                duration: 2000,
                gravity: "bottom", 
                position: "center", 
                style: {
                    background: "linear-gradient(to right, #00b09b, #96c93d)",
                    borderRadius: "20px",
                    fontSize: "14px",
                    boxShadow: "0 3px 6px rgba(0,0,0,0.2)"
                }
            }).showToast();
        }

        // --- 4. Logic: Render Markers & List ---
        // Separate marker creation and list rendering to handle sorting
        
        // A. Create Markers
        locations.forEach((loc, index) => {
            const marker = L.marker([loc.lat, loc.lng], { icon: icons[loc.type] })
                .addTo(map)
                .bindTooltip(loc.name, { permanent: true, direction: 'top', offset: L.point(0, -30), className: 'custom-tooltip' });
            
            const googleMapsLink = `https://www.google.com/maps/search/?api=1&query=${loc.lat},${loc.lng}`;
            
            // Updated Popup UI
            marker.bindPopup(`
                <div class="text-center" style="min-width: 200px;">
                    <b class="text-base text-gray-800">${loc.name}</b><br>
                    <span class="text-xs text-gray-500">${loc.desc}</span>
                    
                    <div class="mt-1 mb-1 p-1 bg-gray-50 border border-gray-200 rounded cursor-pointer hover:bg-gray-100 transition-colors" 
                         onclick="copyAddress('${loc.address}')" title="í´ë¦­í•˜ì—¬ ì£¼ì†Œ ë³µì‚¬">
                        <p class="text-[10px] font-mono text-gray-700 break-words leading-tight select-all text-center">${loc.address}</p>
                    </div>

                    <a href="${googleMapsLink}" target="_blank" 
                       class="inline-block w-full py-1 bg-white text-gray-800 border border-gray-300 text-xs font-bold rounded shadow hover:bg-gray-50 transition-colors no-underline">
                        ğŸ—ºï¸ Google ì§€ë„ì—ì„œ ë³´ê¸°
                    </a>
                </div>
            `);

            // Attach marker to location object for easy access
            loc.marker = marker;
        });

        // B. Group and Sort Locations for List
        const categories = {
            hotel: [],
            special: [],
            shopping: [],
            food: [],
            wife_food: [],
            wife_cafe: []
        };

        // Grouping
        locations.forEach(loc => {
            if (categories[loc.type]) {
                categories[loc.type].push(loc);
            }
        });

        // Sorting & Rendering
        Object.keys(categories).forEach(type => {
            // Sort by Name (Alphabetical)
            categories[type].sort((a, b) => a.name.localeCompare(b.name, 'ko', { sensitivity: 'base' }));

            const listId = `list-${type}`;
            const ul = document.getElementById(listId);
            
            if (ul) {
                ul.innerHTML = ""; // Clear existing (safe measure)
                categories[type].forEach(loc => {
                    const li = document.createElement('li');
                    li.className = "cursor-pointer hover:text-blue-600 hover:bg-blue-50 px-2 py-1 rounded transition-colors flex items-center justify-between group border-b border-gray-100 last:border-0";
                    li.innerHTML = `
                        <span class="text-gray-700 group-hover:text-blue-700">${loc.name}</span>
                        <span class="text-gray-300 text-xs group-hover:text-blue-400">â¤</span>
                    `;
                    
                    li.onclick = () => {
                        // Close sidebar on mobile when clicked
                        if (window.innerWidth < 1024) {
                            toggleList(false);
                        }

                        // Move Map
                        map.setView([loc.lat, loc.lng], 16);
                        
                        // Open Popup
                        loc.marker.openPopup();
                    };
                    ul.appendChild(li);
                });
            }
        });

        // --- 5. Logic: Category Toggle ---
        function toggleCategory(type, isVisible) {
            // Retrieve list of locations for this category
            if(categories[type]) {
                categories[type].forEach(loc => {
                    if (isVisible) {
                        loc.marker.addTo(map);
                    } else {
                        loc.marker.remove();
                    }
                });
            }
        }

        // --- 6. Toggle List Logic ---
        const listHeader = document.getElementById('list-header');
        const listContent = document.getElementById('list-content');
        const toggleIcon = document.getElementById('toggle-icon');
        let isExpanded = true;

        function toggleList(expand) {
            isExpanded = expand;
            if (isExpanded) {
                listContent.style.display = 'block';
                listContent.style.opacity = '1';
                toggleIcon.style.transform = 'rotate(0deg)';
            } else {
                listContent.style.display = 'none';
                listContent.style.opacity = '0';
                toggleIcon.style.transform = 'rotate(180deg)';
            }
        }

        listHeader.onclick = () => {
            toggleList(!isExpanded);
        };

        // Mobile Initial State
        if (window.innerWidth < 1024) {
             toggleList(false);
        }

        // --- 7. Geolocation Logic ---
        let userMarker = null;
        let userCircle = null;

        function findMyLocation() {
            // Toast notification indicating search has started
            Toastify({
                text: "ğŸ“ ìœ„ì¹˜ë¥¼ ì°¾ëŠ” ì¤‘...",
                duration: 2000,
                gravity: "top", 
                position: "center", 
                style: {
                    background: "linear-gradient(to right, #3B82F6, #2563EB)",
                    borderRadius: "20px",
                    fontSize: "14px",
                    boxShadow: "0 3px 6px rgba(0,0,0,0.2)"
                }
            }).showToast();

            map.locate({setView: true, maxZoom: 16, enableHighAccuracy: true});
        }

        function onLocationFound(e) {
            const radius = e.accuracy / 2;

            if (userMarker) map.removeLayer(userMarker);
            if (userCircle) map.removeLayer(userCircle);

            userMarker = L.marker(e.latlng, {
                icon: L.divIcon({
                    className: 'bg-transparent',
                    html: '<div class="user-pulse"></div>',
                    iconSize: [16, 16],
                    iconAnchor: [8, 8]
                })
            }).addTo(map)
            .bindPopup("í˜„ì¬ ë‚´ ìœ„ì¹˜ (ë°˜ê²½ " + Math.round(radius) + "m)").openPopup();

            userCircle = L.circle(e.latlng, radius).addTo(map);
        }

        function onLocationError(e) {
            Toastify({
                text: "ğŸš« ìœ„ì¹˜ ì ‘ê·¼ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.",
                duration: 3000,
                gravity: "top", 
                position: "center", 
                style: {
                    background: "#ef4444",
                    borderRadius: "20px",
                    fontSize: "14px",
                    boxShadow: "0 3px 6px rgba(0,0,0,0.2)"
                }
            }).showToast();
        }

        map.on('locationfound', onLocationFound);
        map.on('locationerror', onLocationError);

    </script>
</body>
</html>
